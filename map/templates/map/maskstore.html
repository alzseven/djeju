<html>
	<head>
		<meta charset="utf-8"/>
		<title>공적 마스크 판매정보</title>
	</head>
	<body>
		{% load static %}
		<div id="map" style="width:100%;height:100%;"></div>
		<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4e63037725e2b7837bb5c426532533f0"></script>
		<script>
			var _lat = parseFloat('{{ strdata.lat | escapejs }}'),
    			_lng = parseFloat('{{ strdata.lng | escapejs }}'),
				lvl = parseInt('{{ strdata.lvl | escapejs }}');

			var container = document.getElementById('map');
			var options = {
				center: new kakao.maps.LatLng(_lat, _lng),
				level: lvl
			};

			var data = JSON.parse('{{ strdata.strdata | escapejs }}');

			var str_data = [];
			for(var i=0; i<data.count; i++) {
				str_data[i] = [	data.stores[i].lat,
								data.stores[i].lng,
								data.stores[i].name,
								data.stores[i].remain_stat];
			}

			var map = new kakao.maps.Map(container, options);

			var markerImageSrc = "{% static 'maskcol.png' %}";
			
			for(var i=0;i<str_data.length;i++){
				if(str_data[i][3] != "break"){
					var markerPosition  = new kakao.maps.LatLng(str_data[i][0],str_data[i][1]); 
					var imageNum = 276;
					switch (str_data[i][3]) {
						case "plenty":
							imageNum = 0;
							break;
						case "some":
							imageNum = 69;
							break;
						case "few":
							imageNum = 138;
							break;
						case "empty":
							imageNum = 207;
						default:
							break;
					}					
					var imageSize = new kakao.maps.Size(69, 69),
					imageOptions = {  
						spriteOrigin: new kakao.maps.Point(0, imageNum),    
						spriteSize: new kakao.maps.Size(69, 276)  
					};     
					var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),    
						marker = createMarker(markerPosition, markerImage);
					marker.setMap(map);
				}
			}
			function createMarkerImage(src, size, options) {
				var markerImage = new kakao.maps.MarkerImage(src, size, options);
				return markerImage;            
			}
			function createMarker(position, image) {
				var marker = new kakao.maps.Marker({
					position: position,
					image: image
				});
				return marker;  
			}  
	</script>
	</body>
</html>